<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Scientific Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #667eea 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .calculator {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 25px;
            width: 100%;
            max-width: 480px;
        }

        .display-section {
            margin-bottom: 20px;
        }

        .expression {
            width: 100%;
            height: 40px;
            background: rgba(0, 0, 0, 0.2);
            border: none;
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
            text-align: right;
            padding: 0 15px;
            margin-bottom: 10px;
            outline: none;
            font-family: 'Courier New', monospace;
        }

        .display {
            width: 100%;
            height: 80px;
            background: rgba(0, 0, 0, 0.3);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 2.2rem;
            text-align: right;
            padding: 0 20px;
            font-weight: 300;
            letter-spacing: 1px;
            outline: none;
            font-family: 'Courier New', monospace;
        }

        .buttons {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
        }

        button {
            height: 55px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            color: white;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            position: relative;
            overflow: hidden;
        }

        button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        button:active {
            transform: translateY(0);
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        button:hover::before {
            left: 100%;
        }

        .function {
            background: rgba(74, 144, 226, 0.6);
            font-size: 0.85rem;
        }

        .function:hover {
            background: rgba(74, 144, 226, 0.8);
        }

        .operator {
            background: rgba(255, 107, 107, 0.6);
            font-size: 1.2rem;
        }

        .operator:hover {
            background: rgba(255, 107, 107, 0.8);
        }

        .number {
            background: rgba(255, 255, 255, 0.15);
            font-size: 1.1rem;
        }

        .number:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .clear {
            background: rgba(255, 193, 7, 0.6);
        }

        .clear:hover {
            background: rgba(255, 193, 7, 0.8);
        }

        .equals {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            grid-column: span 2;
            font-size: 1.3rem;
        }

        .equals:hover {
            background: linear-gradient(45deg, #ee5a24, #ff6b6b);
        }

        .wide {
            grid-column: span 2;
        }

        .mode-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .small-text {
            font-size: 0.75rem;
        }

        .memory-indicator {
            position: absolute;
            top: 5px;
            left: 15px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
        }

        @media (max-width: 600px) {
            .calculator {
                max-width: 100%;
                padding: 20px;
            }
            
            .buttons {
                grid-template-columns: repeat(5, 1fr);
                gap: 8px;
            }
            
            button {
                height: 45px;
                font-size: 0.85rem;
            }
            
            .display {
                height: 70px;
                font-size: 1.8rem;
            }
            
            .function {
                font-size: 0.7rem;
            }
            
            .small-text {
                font-size: 0.65rem;
            }
        }

        .tooltip {
            position: relative;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 8px;
            border-radius: 5px;
            font-size: 0.7rem;
            white-space: nowrap;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <div class="memory-indicator" id="memoryIndicator"></div>
        <button class="mode-toggle" onclick="toggleMode()" id="modeToggle">DEG</button>
        
        <div class="display-section">
            <input type="text" class="expression" id="expression" placeholder="Expression" readonly>
            <input type="text" class="display" id="display" placeholder="0" readonly>
        </div>

        <div class="buttons" id="buttonGrid">
            <!-- Row 1 - Memory and Clear -->
            <button class="clear" onclick="memoryRecall()">MR</button>
            <button class="clear" onclick="memoryClear()">MC</button>
            <button class="clear" onclick="memoryAdd()">M+</button>
            <button class="clear" onclick="memorySubtract()">M−</button>
            <button class="clear" onclick="clearEntry()">CE</button>
            <button class="clear" onclick="clearAll()">AC</button>

            <!-- Row 2 - Advanced Functions -->
            <button class="function tooltip" onclick="insertFunction('Math.sin(')" data-tooltip="Sine">sin</button>
            <button class="function tooltip" onclick="insertFunction('Math.cos(')" data-tooltip="Cosine">cos</button>
            <button class="function tooltip" onclick="insertFunction('Math.tan(')" data-tooltip="Tangent">tan</button>
            <button class="function tooltip" onclick="insertFunction('Math.log10(')" data-tooltip="Log base 10">log</button>
            <button class="function tooltip" onclick="insertFunction('Math.log(')" data-tooltip="Natural log">ln</button>
            <button class="operator" onclick="deleteLast()">⌫</button>

            <!-- Row 3 - Inverse Functions -->
            <button class="function small-text tooltip" onclick="insertFunction('Math.asin(')" data-tooltip="Arcsine">sin⁻¹</button>
            <button class="function small-text tooltip" onclick="insertFunction('Math.acos(')" data-tooltip="Arccosine">cos⁻¹</button>
            <button class="function small-text tooltip" onclick="insertFunction('Math.atan(')" data-tooltip="Arctangent">tan⁻¹</button>
            <button class="function tooltip" onclick="insertFunction('Math.sqrt(')" data-tooltip="Square root">√</button>
            <button class="function tooltip" onclick="insertFunction('Math.cbrt(')" data-tooltip="Cube root">∛</button>
            <button class="operator" onclick="appendToDisplay('/')" data-tooltip="Divide">÷</button>

            <!-- Row 4 - Powers and Numbers -->
            <button class="function tooltip" onclick="insertFunction('Math.pow(', ',')" data-tooltip="Power">xʸ</button>
            <button class="function tooltip" onclick="insertSquare()" data-tooltip="Square">x²</button>
            <button class="function tooltip" onclick="insertCube()" data-tooltip="Cube">x³</button>
            <button class="number" onclick="appendToDisplay('7')">7</button>
            <button class="number" onclick="appendToDisplay('8')">8</button>
            <button class="number" onclick="appendToDisplay('9')">9</button>

            <!-- Row 5 -->
            <button class="operator" onclick="appendToDisplay('*')" data-tooltip="Multiply">×</button>
            <button class="function tooltip" onclick="insertFunction('1/(')" data-tooltip="Reciprocal">1/x</button>
            <button class="function tooltip" onclick="insertFunction('Math.abs(')" data-tooltip="Absolute value">|x|</button>
            <button class="number" onclick="appendToDisplay('4')">4</button>
            <button class="number" onclick="appendToDisplay('5')">5</button>
            <button class="number" onclick="appendToDisplay('6')">6</button>

            <!-- Row 6 -->
            <button class="operator" onclick="appendToDisplay('-')" data-tooltip="Subtract">−</button>
            <button class="function tooltip" onclick="insertConstant('Math.PI')" data-tooltip="Pi">π</button>
            <button class="function tooltip" onclick="insertConstant('Math.E')" data-tooltip="Euler's number">e</button>
            <button class="number" onclick="appendToDisplay('1')">1</button>
            <button class="number" onclick="appendToDisplay('2')">2</button>
            <button class="number" onclick="appendToDisplay('3')">3</button>

            <!-- Row 7 -->
            <button class="operator" onclick="appendToDisplay('+')" data-tooltip="Add">+</button>
            <button class="function tooltip" onclick="insertFunction('Math.exp(')" data-tooltip="e^x">eˣ</button>
            <button class="function tooltip" onclick="insertFunction('factorial(')" data-tooltip="Factorial">x!</button>
            <button class="function" onclick="appendToDisplay('('))">(</button>
            <button class="number wide" onclick="appendToDisplay('0')">0</button>
            <button class="function" onclick="appendToDisplay(')')">)</button>

            <!-- Row 8 -->
            <button class="function tooltip" onclick="insertFunction('Math.random()')" data-tooltip="Random number">Rand</button>
            <button class="operator" onclick="appendToDisplay('%')" data-tooltip="Modulo">mod</button>
            <button class="number" onclick="appendToDisplay('.')">.</button>
            <button class="operator" onclick="toggleSign()" data-tooltip="Plus/Minus">±</button>
            <button class="equals" onclick="calculate()">=</button>
        </div>
    </div>

    <script>
        let display = document.getElementById('display');
        let expression = document.getElementById('expression');
        let memoryValue = 0;
        let angleMode = 'DEG'; // DEG or RAD
        let lastResult = 0;

        function updateMemoryIndicator() {
            const indicator = document.getElementById('memoryIndicator');
            indicator.textContent = memoryValue !== 0 ? 'M' : '';
        }

        function toggleMode() {
            angleMode = angleMode === 'DEG' ? 'RAD' : 'DEG';
            document.getElementById('modeToggle').textContent = angleMode;
        }

        function appendToDisplay(value) {
            if (display.value === '0' || display.value === 'Error' || display.value === 'Infinity') {
                display.value = value;
            } else {
                display.value += value;
            }
            updateExpression();
        }

        function updateExpression() {
            expression.value = display.value;
        }

        function insertFunction(func, separator = '') {
            if (display.value === '0' || display.value === 'Error') {
                display.value = func;
            } else {
                display.value += func;
            }
            if (separator) {
                display.value += display.value.slice(0, -func.length) + separator;
            }
            updateExpression();
        }

        function insertConstant(constant) {
            if (display.value === '0' || display.value === 'Error') {
                display.value = constant;
            } else {
                display.value += constant;
            }
            updateExpression();
        }

        function insertSquare() {
            if (display.value === '0' || display.value === 'Error') {
                display.value = 'Math.pow(0,2)';
            } else {
                const lastNumber = getLastNumber();
                if (lastNumber) {
                    display.value = display.value.replace(new RegExp(escapeRegExp(lastNumber) + '$'), `Math.pow(${lastNumber},2)`);
                } else {
                    display.value += 'Math.pow(,2)';
                }
            }
            updateExpression();
        }

        function insertCube() {
            if (display.value === '0' || display.value === 'Error') {
                display.value = 'Math.pow(0,3)';
            } else {
                const lastNumber = getLastNumber();
                if (lastNumber) {
                    display.value = display.value.replace(new RegExp(escapeRegExp(lastNumber) + '$'), `Math.pow(${lastNumber},3)`);
                } else {
                    display.value += 'Math.pow(,3)';
                }
            }
            updateExpression();
        }

        function getLastNumber() {
            const matches = display.value.match(/[\d.]+$/);
            return matches ? matches[0] : null;
        }

        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function toggleSign() {
            if (display.value && display.value !== '0') {
                if (display.value.startsWith('-')) {
                    display.value = display.value.substring(1);
                } else {
                    display.value = '-' + display.value;
                }
                updateExpression();
            }
        }

        function deleteLast() {
            if (display.value.length > 1) {
                display.value = display.value.slice(0, -1);
            } else {
                display.value = '0';
            }
            updateExpression();
        }

        function clearAll() {
            display.value = '0';
            expression.value = '';
        }

        function clearEntry() {
            display.value = '0';
            updateExpression();
        }

        function factorial(n) {
            if (n < 0) return NaN;
            if (n === 0 || n === 1) return 1;
            let result = 1;
            for (let i = 2; i <= n; i++) {
                result *= i;
            }
            return result;
        }

        function convertAngle(angle) {
            return angleMode === 'DEG' ? angle * Math.PI / 180 : angle;
        }

        function calculate() {
            try {
                let expr = display.value;
                
                // Handle trigonometric functions
                expr = expr.replace(/Math\.sin\(/g, `Math.sin(${angleMode === 'DEG' ? 'Math.PI/180*' : ''}(`);
                expr = expr.replace(/Math\.cos\(/g, `Math.cos(${angleMode === 'DEG' ? 'Math.PI/180*' : ''}(`);
                expr = expr.replace(/Math\.tan\(/g, `Math.tan(${angleMode === 'DEG' ? 'Math.PI/180*' : ''}(`);
                
                // Handle inverse trigonometric functions
                expr = expr.replace(/Math\.asin\(/g, 'Math.asin(');
                expr = expr.replace(/Math\.acos\(/g, 'Math.acos(');
                expr = expr.replace(/Math\.atan\(/g, 'Math.atan(');
                
                // Handle modulo
                expr = expr.replace(/(\d+(?:\.\d+)?)\s*%\s*(\d+(?:\.\d+)?)/g, '($1 % $2)');
                
                // Handle factorial
                expr = expr.replace(/factorial\(([^)]+)\)/g, (match, num) => {
                    const n = parseFloat(num);
                    return factorial(n);
                });

                // Evaluate the expression
                let result = eval(expr);
                
                if (!isFinite(result)) {
                    throw new Error('Invalid calculation');
                }
                
                // Convert inverse trig results back to degrees if needed
                if (angleMode === 'DEG' && (expr.includes('Math.asin') || expr.includes('Math.acos') || expr.includes('Math.atan'))) {
                    result = result * 180 / Math.PI;
                }
                
                // Round to prevent floating point errors
                result = Math.round(result * 1e12) / 1e12;
                
                lastResult = result;
                display.value = result.toString();
                expression.value = '';
                
            } catch (error) {
                display.value = 'Error';
                expression.value = '';
            }
        }

        // Memory functions
        function memoryRecall() {
            display.value = memoryValue.toString();
            updateExpression();
        }

        function memoryClear() {
            memoryValue = 0;
            updateMemoryIndicator();
        }

        function memoryAdd() {
            try {
                const currentValue = parseFloat(display.value) || 0;
                memoryValue += currentValue;
                updateMemoryIndicator();
            } catch (error) {
                // Ignore errors
            }
        }

        function memorySubtract() {
            try {
                const currentValue = parseFloat(display.value) || 0;
                memoryValue -= currentValue;
                updateMemoryIndicator();
            } catch (error) {
                // Ignore errors
            }
        }

        // Keyboard support
        document.addEventListener('keydown', function(event) {
            const key = event.key;
            event.preventDefault();
            
            if (key >= '0' && key <= '9') {
                appendToDisplay(key);
            } else if (key === '.') {
                appendToDisplay('.');
            } else if (key === '+') {
                appendToDisplay('+');
            } else if (key === '-') {
                appendToDisplay('-');
            } else if (key === '*') {
                appendToDisplay('*');
            } else if (key === '/') {
                appendToDisplay('/');
            } else if (key === '%') {
                appendToDisplay('%');
            } else if (key === '(') {
                appendToDisplay('(');
            } else if (key === ')') {
                appendToDisplay(')');
            } else if (key === 'Enter' || key === '=') {
                calculate();
            } else if (key === 'Escape') {
                clearAll();
            } else if (key === 'Backspace') {
                deleteLast();
            } else if (key === 'Delete') {
                clearEntry();
            }
        });

        // Initialize
        updateMemoryIndicator();
        updateExpression();
    </script>
</body>
</html>